# LLVM3.8

OCamlのLLVMを使ってみます。

## [ll1_text](ll1_text)

四則演算のプログラムをテキストで出力して、llcでコンパイルして実行します。

利点:

- ライブラリのインストールが必要ない
- ライブラリのリンクに時間が取られず、処理系のコンパイルが高速
- コンパイラの処理が簡潔になる

欠点:

- エミットのパスがある
- ファイル出力がある
- llcのプロセス起動がある
- llc内でファイル入力とパースの処理がある
- JITをする事ができない。

ライブラリのインストールとリンクの必要がないのでビルドが容易で高速です。
LLVMのバージョン変更にも強いでしょう。
欠点は作成したコンパイラのコンパイル速度が遅い問題があります。
プロセスをコンパイルして実行するので、基本的にJITは出来ません。
JITと同様の事をしたければ、テキストをコンパイルしてバイトコードを読み込んで実行する必要があります。

## [ll2_jit](ll2_jit)

[ll1_text](ll1_text)のEmit部分のみを書き換えて、LLVMのライブラリを使いJITを行って実行します。

利点:

- コンパイルの処理はバックエンドと切り離して考える事ができます。
- バックエンドを複数持つ事が容易です。
- JITが出来る

欠点:

- エミットのパスがある
- ライブラリのリンクに時間がかかる

エミットのパスは残りますが、プロセス起動やパースの処理がなくなるので高速化できます。
JITも行えるので、コンパイルタイムに対象言語でプログラムを操作する事が容易です。

## [ll3_jit](ll3_jit)

[ll1_text](ll1_text),[ll2_jit](ll2_jit)のコンパイル部分で直接LLVMのライブラリ呼び出しを行います。

利点:

- エミットパスが無くなる
- JITが出来る

欠点:

- ライブラリのリンクに時間がかかる
- ライブラリの変更に弱い
- LLVMのライブラリを使いこなす必要がある

エミットのパスが1つなくなるので高速に動作します。
しかし、LLVMのライブラリのインターフェイスが変わればその都度修正が必要になります。
