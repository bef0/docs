# 単相型推論

単相の型推論を実装します。

ここでは、単相の型推論について説明します。型推論の実装方法をご存知の方はここを読む必要はありません。次の単相型システムへの型クラスの導入に進んでください。

単相の型推論では、分からない型にとりあえず未知の型を割り当てます。そして、その型と同じ型である型を同じであるとする連立方程式を作ります。式全体をトラバースして式全体の型の方程式を作り、その方程式を解けば型が求まります。型が決定出来ない場合は、エラーとするか、型システムが決めた型にします。

	let a = fun x -> fun -> x + y in
	a 1 2

のような式があった場合に型推論をすると、

	let a:(t1=t2->t3->int) = fun x:(t2=int) -> fun:(t3=int) -> ((x:int) + (y:int) : int) in
	((a:(t1=int->int->t4)) (1:int) (2:int): t4)

	t1 = t2->t3->int
	t2 = int
	t3 = int
	t1 = int->int->t4

と言う方程式が出来上がります。この式を解くと

	t1 = int->int->int
	t2 = int
	t3 = int
	t4 = int

と計算出来ます。この型を式に代入すると以下のようになります:

	let a:int->int->int = fun x:int -> fun:int -> x + y in
	(a 1 2: int)

従って全体の式の型はintと求まります。

